@model IEnumerable<PlushShop.Models.Product>
@{
    ViewData["Title"] = "Shop";
}

<h1>PlushShop</h1>

<div class="row mb-3">
    <div class="col-md-4">
        <form method="get" asp-controller="Shop" asp-action="Index">
            <div class="input-group">
                <select class="form-select" name="series">
                    <option value="">All Series</option>
                    @foreach (var s in Model.Select(m => m.Series).Distinct())
                    {
                        <option value="@s" selected="@(ViewBag.SelectedSeries == s ? "selected" : null)">
                            @s
                        </option>
                    }
                </select>
                <button class="btn btn-outline-secondary">Filter</button>
            </div>
        </form>
    </div>
</div>

<div class="row">
    @foreach (var p in Model)
    {
        <div class="col-md-3 mb-4">
            <div class="card h-100">
                <img src="@Url.Content($"~/images/products/{p.ImageFileName}")"
                     class="card-img-top"
                     style="height:180px;object-fit:contain"
                     alt="@p.Name" />
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">@p.Name</h5>
                    <p class="card-text small">@p.Company • @p.Series</p>

                    <!-- Display price -->
                    <p class="card-text fw-bold">@p.Price.ToString("C")</p>

                    <div class="mt-auto">
                        <a class="btn btn-sm btn-outline-primary mb-2"
                           asp-controller="Shop"
                           asp-action="Details"
                           asp-route-slug="@p.Slug">View</a>

                        <form method="post"
                              asp-controller="Cart"
                              asp-action="AddToCart"
                              asp-route-slug="@p.Slug"
                              class="d-flex align-items-center">
                            <select name="qty" class="form-select form-select-sm me-2" style="width:70px;">
                                @for (int i = 1; i <= p.Stock; i++)
                                {
                                    <option value="@i">@i</option>
                                }
                            </select>
                            <button class="btn btn-sm btn-success" @(p.Stock == 0 ? "disabled" : "")>
                                @(p.Stock == 0 ? "Out of Stock" : "Add to cart")
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    }
</div>
